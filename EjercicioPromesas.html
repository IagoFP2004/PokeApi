<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio Promesas</title>
    <style>
        
        body{
            background-color: red;
            color: white;
        }

        h1 {
            text-align: center;
        }

        #contenedor div{
            background-color: gray;
            margin: 5px;
            text-align: center;
            border-radius: 10px;
            box-shadow: 5px 5px 5px black;
        }

        #contenedor {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
    </style>
</head>
<body>
    <h1>POKEAPI</h1>
    <div id="contenedor"></div>
    <button>Descargar PDF</button>
    <script>
        var url_Api = "https://pokeapi.co/api/v2/pokemon";

        function obtenerDatos() {
            return new Promise(async (resolve, reject)=>{
                
                const resultado = await fetch(url_Api);

                if (resultado.ok) {
                    const datos = await resultado.json();
                    resolve(datos.results);
                }else{
                    reject("No se han podido obtener los datos")
                }
            
            }) 
        
        }

        function obtenerImagenesPokemon(url_imagen) {
            return new Promise(async(resolve, reject)=>{
                const resultado = await fetch(url_imagen);
               
                if(resultado.ok){
                    const datos = await resultado.json();
                 resolve(datos.sprites.front_default); 
                }else{
                    reject("No se han podido obtener las imagenes de los pokemon")
                }
            })
        }

       function obtenerDatosPokemon(datos) {
            return new Promise(async(resolve, reject)=>{
                class Pokemon {
                constructor(nombre, imagen) {
                    this.nombre = nombre;
                    this.imagen = imagen;
                }
            }

            if (!Array.isArray(datos)) {
                throw new Error("Los datos no tienen el formato adecuado");
            }

            const pokemons = await Promise.all(
                datos.map(async (dato) => {
                    const imagen = await obtenerImagenesPokemon(dato.url);
                    return new Pokemon(dato.name, imagen);
                })
            );
            resolve(pokemons);
            })
        }

        function mostrarPokemons(datosPokemon) {
            var contenedor = document.getElementById("contenedor");
            let i = 0;
            datosPokemon.forEach(datos => {
                const div = document.createElement("div");
                const p = document.createElement("p");
                const img = document.createElement("img");

                p.textContent = datos.nombre;
                img.src = datos.imagen;
                div.id = i++;

                div.appendChild(p);
                div.appendChild(img);
                contenedor.appendChild(div)
                document.body.appendChild(contenedor);
            });
        }

        obtenerDatos()
            .then((datos) => {
                return obtenerDatosPokemon(datos);
            })
            .then((datosPokemons) => {
                return mostrarPokemons(datosPokemons);
            })
            .catch((error) => {
                alert(error);
            });
    </script>
</body>

</html>